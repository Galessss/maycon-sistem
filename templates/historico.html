{% extends 'base.html' %}

{% block content %}
<style>
    /* Estilo dos Botões de Filtro */
    .filter-container { display: flex; gap: 10px; margin-bottom: 25px; }
    .btn-filter {
        padding: 8px 16px;
        background-color: #18181b;
        border: 1px solid #27272a;
        color: #a1a1aa;
        border-radius: 6px;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.2s;
    }
    .btn-filter:hover { border-color: #fafafa; color: #fafafa; }
    .btn-filter.active { background-color: #fafafa; color: #18181b; border-color: #fafafa; font-weight: 600; }

    /* Card Único Dinâmico */
    .card-principal {
        background-color: #18181b;
        border: 1px solid #27272a;
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
        max-width: 400px;
    }
    .card-principal h4 { color: #a1a1aa; font-size: 14px; margin: 0; text-transform: uppercase; letter-spacing: 0.05em; }
    .card-principal p { font-size: 36px; font-weight: 700; margin: 15px 0 5px 0; color: #fafafa; }
    .card-principal small { color: #71717a; font-size: 14px; }

    .chart-container, .table-container {
        background-color: #18181b;
        border: 1px solid #27272a;
        padding: 24px;
        border-radius: 12px;
        margin-bottom: 30px;
    }
    table { width: 100%; border-collapse: collapse; text-align: left; }
    th { color: #a1a1aa; padding: 16px; border-bottom: 1px solid #27272a; font-size: 13px; }
    td { padding: 16px; color: #fafafa; border-bottom: 1px solid #27272a; font-size: 14px; }
</style>

<h2 style="margin-bottom: 20px; color: #fafafa;">Balanço Geral</h2>

<div class="filter-container">
    <a href="?periodo=hoje" class="btn-filter {% if filtro_ativo == 'hoje' %}active{% endif %}">Hoje</a>
    <a href="?periodo=semana" class="btn-filter {% if filtro_ativo == 'semana' %}active{% endif %}">7 Dias</a>
    <a href="?periodo=mes" class="btn-filter {% if filtro_ativo == 'mes' %}active{% endif %}">30 Dias</a>
</div>

<div class="card-principal">
    <h4>{{ titulo_periodo }}</h4>
    <p>R$ {{ total }}</p>
    <small>{{ quantidade }} vendas registradas</small>
</div>

<div class="chart-container">
    <canvas id="salesChart" height="100"></canvas>
</div>

<div class="table-container">
    <h3 style="margin-top:0; font-size: 16px; color: #fafafa; margin-bottom: 15px;">Vendas do Período</h3>
    <table>
        <thead>
            <tr>
                <th>Data/Hora</th>
                <th>Vendedor</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            {% for venda in vendas_recentes %}
            <tr>
                <td>{{ venda.data_venda|date:"d/m H:i" }}</td>
                <td>{{ venda.usuario.username }}</td>
                <td style="color: #4ade80;">R$ {{ venda.total_venda }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="3" style="text-align: center; color: #71717a;">Sem vendas neste período.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('salesChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Início do Período', 'Hoje'],
            datasets: [{
                label: 'Volume de Vendas',
                data: [0, {{ total }}], // Exemplo simples, pode ser expandido com dados diários
                borderColor: '#fafafa',
                backgroundColor: 'rgba(250, 250, 250, 0.05)',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            scales: {
                y: { grid: { color: '#27272a' }, ticks: { color: '#a1a1aa' } },
                x: { ticks: { color: '#a1a1aa' } }
            }
        }
    });
</script>
{% endblock %}